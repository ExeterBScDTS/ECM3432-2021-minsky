jobs:
  include:
  - stage: gatsby-frontend
    language: node_js
    node_js:
    - lts/*
    script:
    - cd minsky-gatsby
    - yarn install
    - yarn build
  - stage: java-backend
    language: java
    jdk:
    - openjdk15
    script:
    - "(cd minsky-one && mvn install; export MAVEN_RESULT=$?)"
    - if [ "$MAVEN_RESULT" -ne 0 ]; then exit 1; fi
  - stage: deploy
    script: skip
    before_deploy:
    - export TAGNAME=`git describe --tags --abbrev=0`
    - pwd
    - "/home/travis/build/ExeterBScDTS/ECM3432-2021-minsky/deploy-scripts/before-deploy.sh"
    deploy:
      provider: releases
      api_key: $GITHUB_OAUTH_TOKEN
      file:
      - "/home/travis/install-${TAGNAME}.tar.gz"
      - "/home/travis/minskyOne-${TAGNAME}.zip"
      draft: false
      on:
        repo: ExeterBScDTS/ECM3432-2021-minsky
        tags: true
