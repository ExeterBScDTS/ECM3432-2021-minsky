jobs:
  include:
  - stage: gatsby-frontend
    language: node_js
    node_js:
    - lts/*
    script:
    - cd minsky-gatsby
    - yarn install
    - yarn build
  - stage: java-backend
    language: java
    jdk:
    - openjdk15
    script:
    - "(cd minsky-one && mvn install; export MAVEN_RESULT=$?)"
    - if [ "$MAVEN_RESULT" -ne 0 ]; then exit 1; fi
  - stage: deploy
    script: skip
    before_deploy:
    - export TAGNAME=`git describe --tags --abbrev=0`
    - pwd
    - "/home/travis/build/ExeterBScDTS/ECM3432-2021-minsky/deploy-scripts/before-deploy.sh"
    deploy:
      provider: releases
      api_key:
        secure: G5qPa0yDgHaJOv84LZrXNpDJg3cQIofJ/rhs5bb6B5O5b4JF/3TnIlbuTVm/9cwczhvCGlIstFMbSzSHy9XeSSc/Q0z+qBZlD2x844HXzMSVKbBgjo8/Cr+xLWfF6gbWGMuIMsBVHG90JQqSX1Jk3Ia2L74oRJB2CHIPGOj9ig3CdFsARHI0sqvWPm7X/DyrWceyARHv0qHNkUOGU+5XWJyhuuiCp3qJTqDwFRt4Hd+iOQs9zLWsM5kaoZre175Mh3ZLZ3XBDF97hj0eOTIJyCKiHq5ni3kOsfK03yZsh7wFvpb9E9g+7F+buZ1TfU6Q0qLmGCskQXP3/AyIdsQJiOg6Lxozhkt15mIXDwG7bi+E0jaZloOzD7D9Pjxrc6iZJCHb0hSR0VFXpBP80+TP9Q/jE+buwT2hrsedkyUWN6SYkX2M5hf2atasvQtVDkRPWxSvWsOwz3iIbGk9hPFRB7xMAUxFYA6BAPPjyBiuLbHvPUsYp7n3Wi14+fYkgt4oPojmuGt1IFLYLb+8CRWaOTcpFrnHS2AUpzDnZQpqpz/5WhZ9Y4cFzsCEB1FaXHgTUTvkfF1cJ2C1FDXcBIdMD59sS0edxOgWPYC1ZGaGEKk8Nd9UmjGNi7WGdbjW7tfRtNNOiSEMEhlDUg/A5nkjfQ1/i86gc6gScC3df0je+aA=
      file:
      - "/home/travis/install-${TAGNAME}.tar.gz"
      - "/home/travis/minskyOne-${TAGNAME}.zip"
      draft: false
      on:
        repo: ExeterBScDTS/ECM3432-2021-minsky
        tags: true
